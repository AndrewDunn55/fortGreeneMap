function addAllMarkers(){console.log("adding markers");for(var e=0,o=mapLocations.length;o>e;e++){var t=mapLocations[e];console.dir(t);var n=new google.maps.Marker({position:t.position,map:map,icon:t.icon,locationType:t.locationType,id:t.id});attachClickBehaviour(n),mapMarkers.push(n)}}function attachClickBehaviour(e){e.addListener("click",function(){console.log(e.id+" clicked");viewModel.setLocationByID(e.id);console.log(viewModel)})}function initMap(){console.log("initMap"),map=new google.maps.Map(document.getElementById("google_map"),{center:center,zoom:16,mapTypeId:"satellite"}),map.markers=[],addAllMarkers(),easingAnimator=EasingAnimator.makeFromCallback(function(e){map.setCenter(e)})}function showAllMarkers(){centerMap();for(var e=0,o=mapMarkers.length;o>e;e++)mapMarkers[e].setVisible(!0)}function moveMap(e){var o=map.getCenter();easingAnimator.easeProp({lat:o.lat(),lng:o.lng()},{lat:e.lat(),lng:e.lng()})}function centerMap(){var e=map.getCenter();easingAnimator.easeProp({lat:e.lat(),lng:e.lng()},center)}function filterMarkers(e){console.log("filterMarkers"),centerMap();for(var o=0,t=mapMarkers.length;t>o;o++)mapMarkers[o].locationType!==e?mapMarkers[o].setVisible(!1):mapMarkers[o].setVisible(!0)}function getCurrentMarker(e){for(var o=0,t=mapMarkers.length;t>o;o++)if(mapMarkers[o].id==e)return mapMarkers[o]}function setCurrentMarker(e,o){var t=getCurrentMarker(e);console.log("relocate? : "+o),o?(moveMap(t.position),setTimeout(function(){t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null)},750)},1500)):(t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null)},750))}var map,EasingAnimator=function(e){e=e||{},this.easingInterval=e.easingInterval,this.duration=e.duration||1e3,this.step=e.step||50,this.easingFn=e.easingFn||function(e,o,t,n){return(e/=n/2)<1?t/2*e*e*e*e+o:-t/2*((e-=2)*e*e*e-2)+o},this.callBack=e.callBack||function(){}};EasingAnimator.makeFromCallback=function(e){return new EasingAnimator({callBack:e})},EasingAnimator.prototype.easeProp=function(e,o){o=o||{};var t=this,n=0,a=JSON.parse(JSON.stringify(e));clearInterval(t.easingInterval),t.easingInterval=setInterval(function(){if(n+=t.step,n>=t.duration)return clearInterval(t.easingInterval),void t.callBack(o);var i=t.easingFn(n,0,1,t.duration);Object.keys(o).forEach(function(t,n){var r=e[t];a[t]=r-i*(r-o[t])}),t.callBack(a)},t.step)};var center={lat:40.688885,lng:-73.977042},mapLocations=[{id:1,position:{lat:40.689752,lng:-73.973224},menuLabel:"Ft. Greene Park",label:"Fort Greene Park",icon:"img/dog.png",locationType:"rec"},{id:2,position:{lat:40.69294,lng:-73.972977},menuLabel:"Lulu & Po",label:"Lulu & Po",icon:"img/lulupo.png",locationType:"food",businessId:"lulu-and-po-brooklyn"},{id:3,position:{lat:40.689887,lng:-73.965081},menuLabel:"Pratt",label:"Pratt Institute",icon:"img/pratt.png",locationType:"school"},{id:4,position:{lat:40.683154,lng:-73.976168},menuLabel:"Barclays Center",label:"Barclays Center",icon:"img/netsLogo.png",locationType:"rec"},{id:5,position:{lat:40.686392,lng:-73.974368},menuLabel:"Cafe Habana",label:"Cafe Habana",icon:"img/habana.png",locationType:"food",businessId:"habana-outpost-brooklyn"},{id:6,position:{lat:40.690485,lng:-73.969433},menuLabel:"Graziella's",label:"Graziella's",icon:"img/graziellas.png",locationType:"food",businessId:"graziellas-brooklyn-11"},{id:8,position:{lat:40.6901,lng:-73.981686},menuLabel:"Junior's",label:"Junior's",icon:"img/juniors1.jpg",locationType:"food",businessId:"juniors-restaurant-brooklyn"},{id:9,position:{lat:40.688645,lng:-73.976391},menuLabel:"Brooklyn Tech",label:"Brooklyn Technical High School",icon:"img/bths.png",locationType:"school"},{id:10,position:{lat:40.686808,lng:-73.977584},menuLabel:"BAM",label:"Brooklyn Academy of Music",icon:"img/bam.png",locationType:"rec"},{id:11,position:{lat:40.688815,lng:-73.969331},menuLabel:"ICI",label:"ICI",icon:"img/ici.png",locationType:"food",businessId:"ici-french-country-kitchen-brooklyn"},{id:12,position:{lat:40.69046,lng:-73.967966},menuLabel:"St. Joseph's",label:"St. Joseph's College (New York)",icon:"img/sjc.png",locationType:"school"}],mapMarkers=[],Location=function(e){this.icon=ko.observable(e.icon),this.position=ko.observable(e.position),this.menuLabel=ko.observable(e.menuLabel),this.label=ko.observable(e.label),this.locationType=ko.observable(e.locationType),this.id=ko.observable(e.id),void 0!=e.businessId&&(this.businessId=ko.observable(e.businessId)),this.image_url=ko.observable(),this.rating=ko.observable(),this.snippet=ko.observable(),this.snippet_image_url=ko.observable(),this.cross_streets=ko.observable(),this.address=ko.observable(),this.display_phone=ko.observable(),this.reviewer=ko.observable(),this.numReviews=ko.observable(),this.url=ko.observable(),this.extract=ko.observable(),this.page_thumb=ko.observable(),this.wiki_link=ko.observable()},ViewModel=function(){var e=this;this.locList=ko.observableArray([]),this.addLocations=function(){mapLocations.forEach(function(o){e.locList.push(new Location(o))})},this.reset=function(){e.locList.removeAll(),e.addLocations(),showAllMarkers()},this.addLocations(),this.setLocationByID=function(o){for(var t=this.locList(),n=0;n<t.length;n++)o==t[n].id()&&e.setLoc(t[n],!1)},this.currentLoc=ko.observable(e.locList()[0]),this.nonce_generate=function(){return Math.floor(1e12*Math.random()).toString()},this.native2ascii=function(e){for(var o="",t=0;t<e.length;t++)if(e.charCodeAt(t)<128)o+=e.charAt(t);else{var n=""+e.charCodeAt(t).toString(16);o+="\\u"+(2===n.length?"00"+n:3===n.length?"0"+n:n)}return o},this.countWords=function(e){return e.split(/\s+/).length},this.getWikipediaInfo=function(o){var t=o.label(),n="https://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&titles="+t+"&callback=?";$.ajax({url:n,dataType:"jsonp",success:function(o){var t=o.query.pages;for(var n in t){var a=t[n].extract;e.countWords(a)>150&&(a=a.replace(/\s+/g," ").split(/(?=\s)/gi).slice(0,150).join("")+" ..."),e.currentLoc().extract(a),e.currentLoc().wiki_link("https://en.wikipedia.org/?curid="+n)}}});var a="http://en.wikipedia.org/w/api.php?action=query&titles="+t+"&prop=pageimages&format=json&pithumbsize=100&callback=?";$.ajax({url:a,dataType:"jsonp",success:function(o){var t=o.query.pages;for(var n in t)e.currentLoc().page_thumb(t[n].thumbnail.source)}})},this.getYelpInfo=function(e){var o="B5S_y-SVAjGX29dG7vpzpA",t="6FpVs_YM8LIRUqFqWxzZw7TynrI",n="risEctsNsFtfaLY4PSPGlVzm4Cize-yz",a="6Xu4jCQ5iLkLj884o0ErpoP853M",i=this,r="https://api.yelp.com/v2/business/"+e.businessId(),s={oauth_consumer_key:o,oauth_token:n,oauth_nonce:this.nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},l=oauthSignature.generate("GET",r,s,t,a);s.oauth_signature=l;var c=["☆☆☆☆☆","★☆☆☆☆","★★☆☆☆","★★★☆☆","★★★★☆","★★★★★"],u={url:r,data:s,cache:!0,dataType:"jsonp",success:function(e){console.dir(e),i.currentLoc().image_url(e.image_url),i.currentLoc().rating(c[Math.floor(e.rating)]),i.currentLoc().snippet(e.snippet_text),e.location.cross_streets&&i.currentLoc().cross_streets(" b/w "+e.location.cross_streets),i.currentLoc().snippet_image_url(e.snippet_image_url),i.currentLoc().address(e.location.address[0]),i.currentLoc().display_phone(e.display_phone),i.currentLoc().reviewer(e.reviews[0].user.name),i.currentLoc().numReviews(e.review_count),i.currentLoc().url(e.url),$("#over_map_detail").fadeIn()},error:function(e){}};$.ajax(u)},this.setLoc=function(o,t){relocate="undefined"==typeof t?!1:!0,console.dir(o),$("#over_map_detail").hide(),e.currentLoc(o),setCurrentMarker(o.id(),t),"food"===o.locationType()?e.getYelpInfo(o):($("#over_map_detail").fadeIn(),e.getWikipediaInfo(o));var n=document.querySelector("#inner_detail"),a=document.querySelector("#expandDetailButton"),i=document.querySelector("#collapseDetailButton"),r=document.querySelector("#over_map");a.addEventListener("click",function(){n.classList.add("expanded")}),i.addEventListener("click",function(){n.classList.remove("expanded")}),r.classList.remove("open")},this.filterRestaurants=function(){e.reset(),e.locList.remove(function(e){return"food"!=e.locationType()}),filterMarkers("food")},this.filterSchools=function(){e.reset(),e.locList.remove(function(e){return"school"!=e.locationType()}),filterMarkers("school")},this.filterRecreation=function(){e.reset(),e.locList.remove(function(e){return"rec"!=e.locationType()}),filterMarkers("rec")}},viewModel=new ViewModel;ko.applyBindings(viewModel);var menuButton=document.querySelector("#menuButton"),main=document.querySelector("main"),menu=document.querySelector("#over_map"),collapseDetailButton=document.querySelector("#collapseDetailButton");menuButton.addEventListener("click",function(e){menu.classList.toggle("open"),$("#over_map_detail").fadeOut(),e.stopPropagation()}),map.addEventListener("click",function(){menu.classList.remove("open")});